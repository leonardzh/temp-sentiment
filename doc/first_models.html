<h1 id="first-model">First Model</h1>
<p>The initial models took the following form, with income as a log-transformed continuous variable.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">vader <span class="op">~</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="st">        </span><span class="co">#Spline term with knots at -10, 0, 5, 10, 15, 20, 25, 30, 35</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="st">        </span>income_percap <span class="op">*</span><span class="st"> </span>temp.hi <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">+</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">15</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">20</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">30</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">35</span>, <span class="dv">0</span>)) </a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10">        <span class="co">#Fixed effects</span></a>
<a class="sourceLine" id="cb1-11" title="11">        <span class="op">|</span><span class="st"> </span>dow <span class="op">+</span><span class="st"> </span>doy <span class="op">+</span><span class="st"> </span>tod <span class="op">+</span><span class="st"> </span>fips <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>statemonth</a></code></pre></div>
<p>And this function yielded the following results:</p>
<figure>
<img src="/home/mattcoop/temp-sentiment/res/temp.hi-income-no-ref-segments-noSE_Noweather.png" alt="Initial results - no standard errors" /><figcaption>Initial results - no standard errors</figcaption>
</figure>
<figure>
<img src="/home/mattcoop/temp-sentiment/res/temp.hi-income-no-ref-segments-SE_Noweather.png" alt="Initial results - with standard errors" /><figcaption>Initial results - with standard errors</figcaption>
</figure>
<p>These results look pretty good, and if we look at income at the 5th, 50th, and 95th percentiles, they are significantly different.</p>
<h1 id="second-model">Second Model</h1>
<p>These results were identical to what I got when working with python, and I was curious why, and I realized our model was missing a bunch of parameters for the effects of temperature independent of incomes. So I ran new models with splines for the effect of temperature alone (without income), as well as splines for temperature interacting with income. So:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">vader <span class="op">~</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="st">        </span><span class="co">#Spline term interacting with income</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">        </span>income_percap <span class="op">*</span><span class="st"> </span>temp.hi <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">+</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">15</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">20</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">30</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="st">        </span><span class="kw">I</span>(income_percap<span class="op">*</span><span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">35</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="st">        </span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="st">        </span><span class="co">#Effects of temperature independent of income</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="st">        </span>temp.hi <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">+</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="st">        </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="st">        </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">15</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">20</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="st">        </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">30</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="st">        </span><span class="kw">I</span>(<span class="kw">pmax</span>(temp.hi <span class="op">-</span><span class="st"> </span><span class="dv">35</span>, <span class="dv">0</span>)) </a>
<a class="sourceLine" id="cb2-16" title="16">        <span class="op">|</span><span class="st"> </span>dow <span class="op">+</span><span class="st"> </span>doy <span class="op">+</span><span class="st"> </span>tod <span class="op">+</span><span class="st"> </span>fips <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>statemonth</a></code></pre></div>
<p>This yielded results with more stark effects of heatwaves on sentiment inequality, and also had a better AIC.</p>
<figure>
<img src="/home/mattcoop/temp-sentiment/res/temp.hi-income-ref-segments-noSE_Noweather.png" alt="Second results - no standard errors" /><figcaption>Second results - no standard errors</figcaption>
</figure>
<figure>
<img src="/home/mattcoop/temp-sentiment/res/temp.hi-income-ref-segments-SE_Noweather.png" alt="Second results - with standard errors" /><figcaption>Second results - with standard errors</figcaption>
</figure>
<p>So these look like better results by the shape of the curves, and by AIC. But the standard errors are so massive that if we include standard errors, you cant even really see the effect!</p>
<h1 id="issue-with-heat-index">Issue with Heat Index</h1>
<p>There also seems to be an issue with the heat index algorithm. There are weird cutoffs in the algorithm that cause bunching in the histogram. For example:</p>
<pre><code>[ins] r$&gt; heat.index(4.5, rh = 50, temperature.metric = &#39;celsius&#39;)
[1] 2

[ins] r$&gt; heat.index(4.4, rh = 50, temperature.metric = &#39;celsius&#39;)
[1] 4</code></pre>
<p>I think we should stick to some kind of heat index, however, because inequalities in sentiment are much more apparent with that metric compared to just raw temperature. So I will calculate the Wet Bulb Globe Temperature, which also captures interactions between RH and temperature (as well as wind and sunshine), and interacts continuously with temperature, without cutoffs in the algorithm. Hopefully this will give us the same results in terms of heatwaves exacerbating inequalities in sentiment.</p>
